<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">MongDB5.x | TenIncense</title>
  
    <link rel="shortcut icon" href="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E8%83%8C%E6%99%AF%202/601644262819_.pic.jpg">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "TenIncense";
  mashiro_option.author_name = "";
  mashiro_option.site_url = "https://github.com/Tenincense0714/";
  mashiro_option.v_appId = "6RN5znkrKL14y7H74i40TEuh-gzGzoHsz";
  mashiro_option.v_appKey = "a9t6VNN6REJFw4IejG3wBYXS";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E8%83%8C%E6%99%AF%202/16.jpg,https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E8%83%8C%E6%99%AF%202/10.jpg,https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E8%83%8C%E6%99%AF%202/13.jpg".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
</head>
</html>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://github.com/Tenincense0714/">
          <img src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E8%83%8C%E6%99%AF%202/601644262819_.pic.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>起风了，我在等风，也在等你。</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="https://github.com/Tenincense0714" target="_blank" class="social-github" title="github">
                    <img src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E8%83%8C%E6%99%AF%202/github.png">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E8%83%8C%E6%99%AF%202/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E8%83%8C%E6%99%AF%202/2111653806100_.pic.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">TenIncense</span>
            <span class="shironeko"></span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/技术/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/生活/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          生活
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/资源/">
                          <i class="fa fa-cloud-download" aria-hidden="true"></i>
                          资源
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/随想/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          随想
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/转载/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          转载
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/悦读/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          书单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/bangumi/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          番组
                        </a>
                      </li>
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/tags/图集/">
                          <i class="fa fa-photo" aria-hidden="true"></i>
                          图集
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/donate/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
                    赞赏
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                      <li>
                        <a href="/theme-sakura/">
                          <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                          主题
                        </a>
                      </li>
                    
                      <li>
                        <a href="/lab/">
                          <i class="fa fa-cogs" aria-hidden="true"></i>
                          Lab
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/client/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-android faa-vertical" aria-hidden="true"></i>
                    客户端
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/atom.xml">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
                    RSS
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E6%96%87%E7%AB%A0%E8%83%8C%E6%99%AF/16.jpg);" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E6%96%87%E7%AB%A0%E8%83%8C%E6%99%AF/16.jpg">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      MongDB5.x</h1>
      <p class="entry-census">
        <span>
          <a href="tenincense.cn">
            <img src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/202205291139260.jpg">
          </a>
        </span>
        <span>
          <a href="tenincense.cn">TenIncense</a>
        </span>
        <span class="bull">
        ·</span>
        2022-4-1<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><ul>
<li>文档地址：<a href="https://docs.mongodb.com/manual/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/</a></li>
</ul>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ul>
<li><p>官方</p>
<p>MongoDB是一个<code>文档数据库</code>，旨在方便应用开发和扩展。</p>
<img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204010903640.png" style="zoom: 40%;">
</li>
<li><p>百度百科</p>
</li>
</ul>
<p>MongoDB是一个<code>基于分布式文件存储的数据库</code>。由C++语言编写。旨在<code>为WEB应用提供可扩展高性能数据存储解决方案</code>。</p>
<p>MongoDB是一个<code>介于关系数据库和非关系数据库</code>之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。他支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型 。Mongo最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，<code>几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引</code>。</p>
<blockquote>
<p><strong>总结: mongoDB 是一个非关系型文档数据库</strong> </p>
</blockquote>
<h3 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h3><ul>
<li>2009年2月，MongoDB数据库首次在数据库领域亮相，打破了关系型数据库一统天下的局面；</li>
<li>2010年8月, MongoDB 1.6发布。这个版本最大的一个功能就是Sharding，自动分片</li>
<li>2014年12月, MongoDB3.0发布。由于收购了WiredTiger 存储引擎，大幅提升了MongoDB的写入性能；</li>
<li>2015年12月，3.2版本发布，开始支持了关系型数据库的核心功能：关联。你可以一次同时查询多个MongoDB的集合。</li>
<li>2016年, MongoDB推出Atlas，在AWS、 Azure 和GCP上的MongoDB托管服务；</li>
<li>2017年10月，MongoDB成功在纳斯达克敲钟，成为26年来第一家以数据库产品为主要业务的上市公司。</li>
<li>2018年6月, MongoDB4.0 发布推出ACID事务支持，成为第一个支持强事务的NoSQL数据库；</li>
<li>2018年–至今，MongoDB已经从一个在数据库领域籍籍无名的“小透明”，变成了话题度和热度都很高的“流量”数据库。</li>
</ul>
<hr>
<h2 id="二、特点"><a href="#二、特点" class="headerlink" title="二、特点"></a>二、特点</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>面向集合存储，易存储对象类型的数据</li>
<li>支持查询,以及动态查询</li>
<li>支持RUBY，PYTHON，JAVA，C++，PHP，C#等多种语言</li>
<li>文件存储格式为BSON（一种JSON的扩展）</li>
<li>支持复制和故障恢复和分片</li>
<li>支持事务支持</li>
<li>索引 聚合 关联….</li>
</ul>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>游戏应用：使用云数据库MongoDB作为游戏服务器的数据库存储用户信息。用户的游戏装备、积分等直接以内嵌文档的形式存储，方便进行查询与更新。</li>
<li>物流应用：使用云数据库MongoDB存储订单信息，订单状态在运送过程中会不断更新，以云数据库MongoDB内嵌数组的形式来存储，一次查询就能将订单所有的变更读取出来，方便快捷且一目了然。</li>
<li>社交应用：使用云数据库MongoDB存储用户信息以及用户发表的朋友圈信息，通过地理位置索引实现附近的人、地点等功能。并且，云数据库MongoDB非常适合用来存储聊天记录，因为它提供了非常丰富的查询，并在写入和读取方面都相对较快。</li>
<li>视频直播：使用云数据库MongoDB存储用户信息、礼物信息等。</li>
<li>大数据应用：使用云数据库MongoDB作为大数据的云存储系统，随时进行数据提取分析，掌握行业动态。</li>
</ul>
<hr>
<h2 id="三、安装"><a href="#三、安装" class="headerlink" title="三、安装"></a>三、安装</h2><h3 id="传统方式"><a href="#传统方式" class="headerlink" title="传统方式"></a>传统方式</h3><pre><code class="sql"># 1.下载 MongoDB
- https://www.mongodb.com/try/download/community
# 2.将下载安装包上传到 linux 系统
- tar -zxf mongodb-linux-aarch64-ubuntu2004-5.0.5.tgz 
# 3.查看安装目录
- ls
    - `bin`目录   用来存放启动mongoDB的服务以及客户端链接的脚本文件等
        - `install_compass*`    安装 compass 工具的脚本
        - `mongo*`    对应 MongoDB 客户端的脚本
        - `mongod*` 启动 mongo 服务的启动脚本
        - `mongos*` 后面讲分片时会讲到的一个路由脚本
# 4.启动 MongoDB 服务
- ./mongod --port=27017 --dbpath=../data --logpath=../logs/mongo.log
    `--port`    指定服务监听端口号 默认为 27017
    `--dbpath`  指定 mongodb 数据存放目录 启动要求目录必须存在
    `--logpath` 指定 mongodb 日志文件存放位置
    `--fork`    后台运行进程</code></pre>
<p><code>注意: 由于指定日志文件因此启动时日志输出到日志中终端不显示任何日志</code></p>
<pre><code class="sql"># 5.客户端连接
- ./mongo --port=27017</code></pre>
<h3 id="Docker方式"><a href="#Docker方式" class="headerlink" title="Docker方式"></a>Docker方式</h3><pre><code class="dockerfile"># 1.拉取 mongodb 镜像
- docker pull mongo:5.0.5
# 2.运行 mongo 镜像
- docker run -d --name mongo -p 27017:27017 mongo:5.0.5
# 3.进入 mongo 容器
- docker exec -it bc6c bash</code></pre>
<hr>
<h2 id="四、核心概念"><a href="#四、核心概念" class="headerlink" title="四、核心概念"></a>四、核心概念</h2><h3 id="库"><a href="#库" class="headerlink" title="库"></a>库<database></database></h3><p>​    <code>mongodb中的库就类似于传统关系型数据库中库的概念，用来通过不同库隔离不同应用数据</code>。mongodb中可以建立多个数据库。每一个库都有自己的集合和权限，不同的数据库也放置在不同的文件中。默认的数据库为”test”，数据库存储在启动指定的data目录中。</p>
<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合<collection></collection></h3><p>​    <code>集合就是 MongoDB 文档组，类似于 RDBMS （关系数据库管理系统：Relational Database Management System)中的表的概念</code>。</p>
<p>集合存在于数据库中，一个库中可以创建多个集合。每个集合没有固定的结构，这意味着你在对集合可以插入不同格式和类型的数据，但通常情况下我们插入集合的数据都会有一定的关联性。</p>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档<document></document></h3><p>文档集合中一条条记录，是一组键值(key-value)对(即 BSON)。MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。</p>
<p>一个简单的文档例子如下：</p>
<pre><code class="json">{&quot;site&quot;:&quot;https://tenincense.gitee.io&quot;, &quot;name&quot;:&quot;十香&quot;}</code></pre>
<h3 id="关系总结"><a href="#关系总结" class="headerlink" title="关系总结"></a>关系总结</h3><p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204031519733.png" alt></p>
<hr>
<h2 id="五、基本操作"><a href="#五、基本操作" class="headerlink" title="五、基本操作"></a>五、基本操作</h2><h3 id="库-1"><a href="#库-1" class="headerlink" title="库"></a>库<database></database></h3><ul>
<li><p>查看所有库</p>
<pre><code class="sql">&gt; show databases; | show dbs;</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204022019231.png" alt></p>
<p><code>注意:</code></p>
<ul>
<li><strong><code>admin</code></strong>： 从权限的角度来看，这是”root”数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。 </li>
<li><strong><code>local</code></strong>: 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合</li>
<li><strong><code>config</code></strong>: 当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息。</li>
</ul>
</li>
<li><p>创建数据库</p>
<pre><code class="sql">&gt; use 库名</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204022023074.png" alt></p>
</li>
</ul>
<p><code>注意: use 代表创建并使用,当库中没有数据时默认不显示这个库</code></p>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204022026654.png" alt></p>
<ul>
<li><p>删除数据库</p>
<ul>
<li><code>默认删除当前选中的库</code></li>
</ul>
<pre><code class="sql">&gt; db.dropDatabase()</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204022032227.png" alt></p>
</li>
<li><p>查看当前所在库</p>
<pre><code class="sql">&gt; db;</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204022032870.png" alt></p>
</li>
</ul>
<h3 id="集合-1"><a href="#集合-1" class="headerlink" title="集合"></a>集合<collection></collection></h3><ul>
<li><p>查看库中所有集合</p>
<pre><code class="sql">&gt; show collections; | show tables;</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204022035872.png" alt></p>
</li>
<li><p>创建集合</p>
<pre><code class="sql">&gt; db.createCollection(&#39;集合名称&#39;, [options])</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204022040012.png" alt></p>
</li>
</ul>
<p><code>options可以是如下参数：</code></p>
<table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">capped</td>
<td align="left">布尔</td>
<td align="left">（可选）如果为 true，则创建固定集合。固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档。 <strong>当该值为 true 时，必须指定 size 参数。</strong></td>
</tr>
<tr>
<td align="left">size</td>
<td align="left">数值</td>
<td align="left">（可选）为固定集合指定一个最大值，即字节数。 <strong>如果 capped 为 true，也需要指定该字段。</strong></td>
</tr>
<tr>
<td align="left">max</td>
<td align="left">数值</td>
<td align="left">（可选）指定固定集合中包含文档的最大数量。</td>
</tr>
</tbody></table>
<pre><code class="sql">#如
&gt; db.createCollection(&#39;products&#39;,{max:100,capped:true,size:5000}); #当文档数量达到 5000 的时候会进行覆盖，达到 100 的时候，也会进行覆盖</code></pre>
<p><code>注意:当集合不存在时,向集合中插入文档也会自动创建该集合。</code></p>
<pre><code class="sql">&gt; db.emps.insert({name:&#39;十香&#39;})；    #emps 集合不存在，插入文档时会自动创建集合</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204030044242.png" alt></p>
<ul>
<li><p>删除集合 </p>
<pre><code class="sql">&gt; db.集合名称.drop();</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204031445178.png" alt></p>
</li>
</ul>
<h3 id="文档-1"><a href="#文档-1" class="headerlink" title="文档"></a>文档<document></document></h3><p>参考文档: <a href="https://docs.mongodb.com/manual/reference/method/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/method/</a></p>
<h4 id="插入文档"><a href="#插入文档" class="headerlink" title="插入文档"></a>插入文档</h4><ul>
<li><p>单条文档</p>
<pre><code class="sql">&gt; db.集合名称.insert({&quot;name&quot;:&quot;十香&quot;,&quot;age&quot;:25,&quot;bir&quot;:&quot;2022-12-12&quot;});</code></pre>
</li>
<li><p>多条文档</p>
<pre><code class="sql">&gt; db.集合名称.insertMany(
   [ &lt;document 1&gt; , &lt;document 2&gt;, ... ],
   {
             writeConcern: 1,//写入策略，默认为 1，即要求确认写操作，0 是不要求。
      ordered: true //指定是否按顺序写入，默认 true，按顺序写入。
   }
)
#新版本可以直接使用 insert 插入多条文档
&gt; db.集合名称.insert([
      {&quot;name&quot;:&quot;十香&quot;,&quot;age&quot;:23,&quot;bir&quot;:&quot;2012-12-12&quot;},
      {&quot;name&quot;:&quot;小白&quot;,&quot;age&quot;:25,&quot;bir&quot;:&quot;2012-12-12&quot;}
]);</code></pre>
</li>
<li><p>脚本方式</p>
<pre><code class="javascript">for(let i=0;i&lt;100;i++){
    db.users.insert({&quot;_id&quot;:i,&quot;name&quot;:&quot;十香_&quot;+i,&quot;age&quot;:23});
}</code></pre>
</li>
</ul>
<p><code>注意:在 mongodb 中每个文档都会有一个_id作为唯一标识,_id默认会自动生成如果手动指定将使用手动指定的值作为_id 的值。</code></p>
<h4 id="查询所有"><a href="#查询所有" class="headerlink" title="查询所有"></a>查询所有</h4><pre><code class="sql">&gt; db.集合名称.find();</code></pre>
<h4 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h4><pre><code class="sql">db.集合名称.remove(
   &lt;query&gt;,
   {
     justOne: &lt;boolean&gt;,
     writeConcern: &lt;document&gt;
   }
)</code></pre>
<h5 id="参数说明："><a href="#参数说明：" class="headerlink" title="参数说明："></a>参数说明：</h5><ul>
<li><strong>query</strong> :<code>可选</code>删除的文档的条件。</li>
<li><strong>justOne</strong> : <code>可选</code>如果设为 true 或 1，则只删除一个文档，如果不设置该参数，或使用默认值 false，则删除所有匹配条件的文档。</li>
<li><strong>writeConcern</strong> :<code>可选</code>抛出异常的级别。</li>
</ul>
<h4 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h4><pre><code class="sql">db.集合名称.update(
   &lt;query&gt;,
   &lt;update&gt;,
   {
     upsert: &lt;boolean&gt;,
     multi: &lt;boolean&gt;,
     writeConcern: &lt;document&gt;
   }
);</code></pre>
<h5 id="参数说明：-1"><a href="#参数说明：-1" class="headerlink" title="参数说明："></a>参数说明：</h5><ul>
<li><strong>query</strong> : update的查询条件，类似sql update查询内where后面的。</li>
<li><strong>update</strong> : update的对象和一些更新的操作符（如$,$inc…）等，也可以理解为sql update查询内set后面的</li>
<li><strong>upsert</strong> : <code>可选</code>，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。</li>
<li><strong>multi</strong> : <code>可选</code>，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。</li>
<li><strong>writeConcern</strong> :<code>可选</code>，抛出异常的级别。</li>
</ul>
<pre><code class="markdown">- db.集合名称.update({&quot;name&quot;:&quot;zhangsan&quot;},{name:&quot;11&quot;,bir:new date()}) 
    `这个更新是将符合条件的全部更新成后面的文档,相当于先删除在更新`
- db.集合名称.update({&quot;name&quot;:&quot;xiaohei&quot;},{$set:{name:&quot;mingming&quot;}})
    `保留原来数据更新,但是只更新符合条件的第一条数据`
- db.集合名称.update({name:&quot;小黑&quot;},{$set:{name:&quot;小明&quot;}},{multi:true})        
    `保留原来数据更新,更新符合条件的所有数据`
- db.集合名称.update({name:&quot;小黑&quot;},{$set:{name:&quot;小明&quot;}},{multi:true,upsert:true})
    `保留原来数据更新,更新符合条件的所有数据 没有条件符合时插入数据</code></pre>
<hr>
<h2 id="六、文档查询"><a href="#六、文档查询" class="headerlink" title="六、文档查询"></a>六、文档查询</h2><p><strong>MongoDB 查询文档使用 find() 方法。find() 方法以非结构化的方式来显示所有文档。</strong></p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><pre><code class="sql">&gt; db.集合名称.find(query, projection)</code></pre>
<ul>
<li><strong>query</strong> ：可选，使用查询操作符指定查询条件</li>
<li><strong>projection</strong> ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）。</li>
</ul>
<p>如果你需要以易读的方式来读取数据，可以使用 pretty() 方法，语法格式如下</p>
<pre><code class="sql">&gt; db.集合名称.find().pretty()</code></pre>
<p><code>注意: pretty() 方法以格式化的方式来显示所有文档。</code></p>
<h3 id="对比语法"><a href="#对比语法" class="headerlink" title="对比语法"></a>对比语法</h3><p>如果你熟悉常规的 SQL 数据，通过下表可以更好的理解 MongoDB 的条件语句查询：</p>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204031816873.png" alt></p>
<h3 id="AND"><a href="#AND" class="headerlink" title="AND"></a>AND</h3><pre><code class="sql">&gt; db.集合名称.find({key1:value1, key2:value2,...}).pretty()</code></pre>
<p><code>类似于 WHERE 语句：WHERE key1=value1 AND key2=value2</code></p>
<blockquote>
<p>注意：如果相同的字段出现多次，以后面出现的为准</p>
<p>如： db.users.find({age:24,age:{$gte:29}})    后面的 age 条件会把前面的 age 条件覆盖掉</p>
</blockquote>
<h3 id="OR"><a href="#OR" class="headerlink" title="OR"></a>OR</h3><p>MongoDB OR 条件语句使用了关键字 <strong>$or</strong>,语法格式如下：</p>
<pre><code class="sql">&gt; db.集合名称.find(
   {
      $or: [
         {key1: value1}, {key2:value2}
      ]
   }
).pretty()</code></pre>
<p><code>类似于 WHERE 语句：WHERE key1=value1 or key2=value2</code></p>
<h3 id="AND-和-OR-联合"><a href="#AND-和-OR-联合" class="headerlink" title="AND 和 OR 联合"></a>AND 和 OR 联合</h3><p><code>类似SQL语句为：&#39;where age &gt;50 AND (name = &#39;十香&#39; OR name = &#39;MongoDB&#39;)&#39;</code></p>
<pre><code class="sql">&gt; db.集合名称.find({&quot;age&quot;: {$gt:50}, $or: [{&quot;name&quot;: &quot;十香&quot;},{&quot;name&quot;: &quot;MongoDB&quot;}]}).pretty();</code></pre>
<h3 id="数组中查询"><a href="#数组中查询" class="headerlink" title="数组中查询"></a>数组中查询</h3><pre><code class="sql">-- 测试数据
&gt; db.集合名称.insert({ &quot;_id&quot; : 11, &quot;age&quot; : 29, &quot;likes&quot; : [ &quot;看电视&quot;, &quot;读书xx&quot;, &quot;美女&quot; ], &quot;name&quot; : &quot;十香_xx_11&quot; })
-- 执行数组查询
&gt; db.users.find({likes:&quot;看电视&quot;})
-- $size 按照数组长度查询
&gt; db.users.find({likes:{$size:3}});</code></pre>
<h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><p><code>类似 SQL 中为 &#39;where name like &#39;%name%&#39;&#39;</code></p>
<pre><code class="sql">&gt; db.users.find({name:/香/});</code></pre>
<p><code>注意:在 mongoDB 中使用正则表达式可以是实现近似模糊查询功能</code></p>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><pre><code class="sql">&gt; db.集合名称.find().sort({name:1,age:1}),
- 1 升序  -1 降序</code></pre>
<p><code>类似 SQL 语句为: &#39;order by name,age&#39;</code></p>
<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><pre><code class="sql">&gt; db.集合名称.find().sort({条件}).skip(start).limit(rows);</code></pre>
<p><code>类似于 SQL 语句为: &#39;limit start,rows&#39;</code></p>
<h3 id="总条数"><a href="#总条数" class="headerlink" title="总条数"></a>总条数</h3><pre><code class="sql">&gt; db.集合名称.count();
&gt; db.集合名称.find({&quot;name&quot;:&quot;十香&quot;}).count();</code></pre>
<p><code>类似于 SQL 语句为: &#39;select count(id) from ....&#39;</code></p>
<h3 id="去重"><a href="#去重" class="headerlink" title="去重"></a>去重</h3><pre><code class="sql">&gt; db.集合名称.distinct(&#39;字段&#39;)</code></pre>
<p><code>类似于 SQL 语句为: &#39;select distinct name from ....&#39;</code></p>
<h3 id="指定返回字段"><a href="#指定返回字段" class="headerlink" title="指定返回字段"></a>指定返回字段</h3><pre><code class="sql">&gt; db.集合名称.find({条件},{name:1,age:1}) 
- 参数2: 1 返回  0 不返回    `注意:1和0不能同时使用`</code></pre>
<hr>
<h2 id="七、-type"><a href="#七、-type" class="headerlink" title="七、$type"></a>七、$type</h2><h3 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h3><p>$type操作符是基于BSON类型来检索集合中匹配的数据类型，并返回结果。</p>
<p>MongoDB 中可以使用的类型如下表所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204041630286.png" alt></p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><pre><code class="sql">&gt; db.col.insert({
    title: &#39;PHP 教程&#39;, 
    description: &#39;PHP 是一种创建动态交互性站点的强有力的服务器端脚本语言。&#39;,
    by: &#39;十香&#39;,
    url: &#39;https://tenincense.gitee.io&#39;,
    tags: [&#39;php&#39;],
    likes: 200
});

&gt; db.col.insert({
    title: &#39;Java 教程&#39;, 
    description: &#39;Java 是由Sun Microsystems公司于1995年5月推出的高级程序设计语言。&#39;,
    by: &#39;十香&#39;,
    url: &#39;https://tenincense.gitee.io&#39;,
    tags: [&#39;java&#39;],
    likes: 550
});

&gt; db.col.insert({
    title: &#39;MongoDB 教程&#39;, 
    description: &#39;MongoDB 是一个 Nosql 数据库&#39;,
    by: &#39;十香&#39;,
    url: &#39;https://tenincense.gitee.io&#39;,
    tags: [&#39;mongodb&#39;],
    likes: 100
});

&gt; db.col.insert({
    title: 2233, 
    description: &#39;2233 是一个 B站的&#39;,
    by: &#39;十香&#39;,
    url: &#39;https://tenincense.gitee.io&#39;,
    tags: [&#39;2233&#39;],
    likes: 100
});</code></pre>
<ul>
<li>如果想获取 “col” 集合中 title 为 String 的数据，你可以使用以下命令：</li>
</ul>
<pre><code class="sql">db.col.find({&quot;title&quot; : {$type : 2}}).pretty();
或
db.col.find({&quot;title&quot; : {$type : &#39;string&#39;}}).pretty();</code></pre>
<ul>
<li>如果想获取 “col” 集合中 tags 为 Array 的数据，你可以使用以下命令：</li>
</ul>
<pre><code class="sql">dge
或
db.col.find({&quot;tags&quot; : {$type : &#39;array&#39;}}).pretty();</code></pre>
<hr>
<h2 id="八、索引"><a href="#八、索引" class="headerlink" title="八、索引"></a>八、索引<index></index></h2><p><a href="https://docs.mongodb.com/manual/indexes/" target="_blank" rel="noopener">官方文档</a></p>
<h3 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h3><p>索引通常能够极大的提高查询的效率，如果没有索引，MongoDB在读取数据时必须扫描集合中的每个文件并选取那些符合查询条件的记录。这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的。索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构。</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204041658302.png" alt></p>
<blockquote>
<p>从根本上说，MongoDB中的索引与其他数据库系统中的索引类似。MongoDB在集合层面上定义了索引，并支持对MongoDB集合中的任何字段或文档的子字段进行索引。</p>
</blockquote>
<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><h4 id="0、创建索引"><a href="#0、创建索引" class="headerlink" title="0、创建索引"></a>0、创建索引</h4><pre><code class="sql">&gt; db.集合名称.createIndex(keys, options)
#如下
&gt; db.集合名称.createIndex({&quot;title&quot;:1,&quot;description&quot;:-1})</code></pre>
<p><code>说明: 语法中 Key 值为你要创建的索引字段，1 为指定按升序创建索引，如果你想按降序来创建索引指定为 -1 即可。</code></p>
<p>createIndex() 接收可选参数，可选参数列表如下：</p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>background</code></td>
<td align="left">Boolean</td>
<td align="left">建索引过程会阻塞其它数据库操作，background可指定以后台方式创建索引，即增加 “background” 可选参数。 “background” 默认值为<strong>false</strong>。</td>
</tr>
<tr>
<td align="left"><code>unique</code></td>
<td align="left">Boolean</td>
<td align="left">建立的索引是否唯一。指定为true创建唯一索引。默认值为<strong>false</strong>.</td>
</tr>
<tr>
<td align="left"><code>name</code></td>
<td align="left">string</td>
<td align="left">索引的名称。如果未指定，MongoDB的通过连接索引的字段名和排序顺序生成一个索引名称。</td>
</tr>
<tr>
<td align="left">sparse</td>
<td align="left">Boolean</td>
<td align="left">对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为true的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 <strong>false</strong>.</td>
</tr>
<tr>
<td align="left"><code>expireAfterSeconds</code></td>
<td align="left">integer</td>
<td align="left">指定一个以秒为单位的数值，完成 TTL设定，设定集合的生存时间。</td>
</tr>
<tr>
<td align="left"><code>v</code></td>
<td align="left">index version</td>
<td align="left">索引的版本号。默认的索引版本取决于mongod创建索引时运行的版本。</td>
</tr>
<tr>
<td align="left">weights</td>
<td align="left">document</td>
<td align="left">索引权重值，数值在 1 到 99,999 之间，表示该索引相对于其他索引字段的得分权重。</td>
</tr>
<tr>
<td align="left">default_language</td>
<td align="left">string</td>
<td align="left">对于文本索引，该参数决定了停用词及词干和词器的规则的列表。 默认为英语</td>
</tr>
<tr>
<td align="left">language_override</td>
<td align="left">string</td>
<td align="left">对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的language，默认值为 language.</td>
</tr>
</tbody></table>
<h4 id="1、查看集合索引"><a href="#1、查看集合索引" class="headerlink" title="1、查看集合索引"></a>1、查看集合索引</h4><pre><code class="sql">&gt; db.集合名称.getIndexes()</code></pre>
<h4 id="2、查看集合索引大小"><a href="#2、查看集合索引大小" class="headerlink" title="2、查看集合索引大小"></a>2、查看集合索引大小</h4><pre><code class="sql">&gt; db.集合名称.totalIndexSize()</code></pre>
<h4 id="3、删除集合所有索引"><a href="#3、删除集合所有索引" class="headerlink" title="3、删除集合所有索引"></a>3、删除集合所有索引</h4><pre><code class="sql">&gt; db.集合名称.dropIndexes()</code></pre>
<h4 id="4、删除集合指定索引"><a href="#4、删除集合指定索引" class="headerlink" title="4、删除集合指定索引"></a>4、删除集合指定索引</h4><pre><code class="sql">&gt; db.集合名称.dropIndex(&quot;索引名称&quot;)</code></pre>
<h3 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h3><blockquote>
<p>说明: 一个索引的值是由多个 key 进行维护的索引的称之为复合索引</p>
</blockquote>
<pre><code class="sql">&gt; db.集合名称.createIndex({&quot;title&quot;:1,&quot;description&quot;:-1})</code></pre>
<p>​    <code>注意: mongoDB 中复合索引和传统关系型数据库一致都是左前缀原则</code></p>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204051425771.png" alt></p>
<p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204051425160.png" alt></p>
<h2 id="九、聚合"><a href="#九、聚合" class="headerlink" title="九、聚合"></a>九、聚合<aggregate></aggregate></h2><h3 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h3><p>MongoDB 中聚合(aggregate)主要用于处理数据(诸如统计平均值，求和等)，并返回计算后的数据结果。有点类似 <strong>SQL</strong> 语句中的 <strong>count(*)</strong>。</p>
<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><pre><code class="sql">{
   title: &#39;MongoDB Overview&#39;, 
   description: &#39;MongoDB is no sql database&#39;,
   by_user: &#39;runoob.com&#39;,
   url: &#39;http://www.runoob.com&#39;,
   tags: [&#39;mongodb&#39;, &#39;database&#39;, &#39;NoSQL&#39;],
   likes: 100
},
{
   title: &#39;NoSQL Overview&#39;, 
   description: &#39;No sql database is very fast&#39;,
   by_user: &#39;runoob.com&#39;,
   url: &#39;http://www.runoob.com&#39;,
   tags: [&#39;mongodb&#39;, &#39;database&#39;, &#39;NoSQL&#39;],
   likes: 10
},
{
   title: &#39;Neo4j Overview&#39;, 
   description: &#39;Neo4j is no sql database&#39;,
   by_user: &#39;Neo4j&#39;,
   url: &#39;http://www.neo4j.com&#39;,
   tags: [&#39;neo4j&#39;, &#39;database&#39;, &#39;NoSQL&#39;],
   likes: 750
}</code></pre>
<p>现在我们通过以上集合计算每个作者所写的文章数，使用aggregate()计算结果如下：</p>
<pre><code class="sql">&gt; db.集合名称.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$sum : 1}}}])</code></pre>
<h3 id="常见聚合表达式"><a href="#常见聚合表达式" class="headerlink" title="常见聚合表达式"></a>常见聚合表达式</h3><p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204051427432.png" alt></p>
<h2 id="十、整合应用"><a href="#十、整合应用" class="headerlink" title="十、整合应用"></a>十、整合应用</h2><p><strong>说明: 这里主要以 springboot 应用为基础应用进行整合开发。</strong></p>
<p>Spring Data : <code>Spring 数据框架 JPA 、Redis、Elasticsearch、AMQP、MongoDB</code></p>
<p><code>JdbcTemplate</code></p>
<p><code>RedisTemplate</code></p>
<p><code>ElasticTempalte</code></p>
<p><code>AmqpTemplate</code></p>
<p><code>MongoTemplate</code></p>
<p>SpringBoot  Spring Data  MongoDB</p>
<h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><h4 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h4><pre><code class="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<h4 id="编写配置"><a href="#编写配置" class="headerlink" title="编写配置"></a>编写配置</h4><pre><code class="properties"># mongodb 没有开启任何安全协议
# mongodb(协议)://121.5.167.13(主机):27017(端口)/baizhi(库名)
spring.data.mongodb.uri=mongodb://121.5.167.13:27017/baizhi


# mongodb 存在密码
#spring.data.mongodb.host=tx.chenyn.cn
#spring.data.mongodb.port=27017
#spring.data.mongodb.database=baizhi
#spring.data.mongodb.username=root
#spring.data.mongodb.password=root</code></pre>
<h3 id="集合操作"><a href="#集合操作" class="headerlink" title="集合操作"></a>集合操作</h3><h4 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a>创建集合</h4><pre><code class="java">@Test
public void testCreateCollection(){
  mongoTemplate.createCollection(&quot;users&quot;);//参数: 创建集合名称
}</code></pre>
<p><code>注意:创建集合不能存在,存在报错</code></p>
<h4 id="删除集合"><a href="#删除集合" class="headerlink" title="删除集合"></a>删除集合</h4><pre><code class="java">@Test
public void testDeleteCollection(){
  mongoTemplate.dropCollection(&quot;users&quot;);
}</code></pre>
<h3 id="相关注解"><a href="#相关注解" class="headerlink" title="相关注解"></a>相关注解</h3><ul>
<li><code>@Document</code><ul>
<li>修饰范围:     用在类上</li>
<li>作用:    用来映射这个类的一个对象为 mongo 中一条文档数据</li>
<li>属性：(<code>value 、collection</code> )用来指定操作的集合名称</li>
</ul>
</li>
<li><code>@Id</code><ul>
<li>修饰范围:  用在成员变量、方法上</li>
<li>作用：       用来将成员变量的值映射为文档的_id 的值</li>
</ul>
</li>
<li><code>@Field</code><ul>
<li>修饰范围:  用在成员变量、方法上</li>
<li>作用:          用来将成员变量以及值映射为文档中一个key、value对</li>
<li>属性:         ( <code>name,value</code>)用来指定在文档中 key 的名称,默认为成员变量名</li>
</ul>
</li>
<li><code>@Transient</code><ul>
<li>修饰范围: 用在成员变量、方法上</li>
<li>作用        : 用来指定改成员变量，不参与文档的序列化</li>
</ul>
</li>
</ul>
<h3 id="文档操作"><a href="#文档操作" class="headerlink" title="文档操作"></a>文档操作</h3><h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><ul>
<li><strong>Criteria</strong> </li>
</ul>
<p>​    <img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204051448038.png" alt></p>
<ul>
<li>常见查询</li>
</ul>
<pre><code class="java">@Test
public void testQuery(){
  //基于 id 查询
  template.findById(&quot;1&quot;,User.class);

  //查询所有
  template.findAll(User.class);
  template.find(new Query(),User.class);

  //等值查询
  template.find(Query.query(Criteria.where(&quot;name&quot;).is(&quot;十香&quot;)), 
               User.class);

  // &gt; gt  &lt; lt  &gt;= gte  &lt;= lte
  template.find(Query.query(Criteria.where(&quot;age&quot;).lt(25)),
                User.class);
  template.find(Query.query(Criteria.where(&quot;age&quot;).gt(25)),
                User.class);
  template.find(Query.query(Criteria.where(&quot;age&quot;).lte(25)),
                User.class);
  template.find(Query.query(Criteria.where(&quot;age&quot;).gte(25)),
                User.class);

  //and
  template.find(Query.query(Criteria.where(&quot;name&quot;).is(&quot;十香&quot;)
                            .and(&quot;age&quot;).is(23)),User.class);

  //or
  Criteria criteria = new Criteria()
    .orOperator(Criteria.where(&quot;name&quot;).is(&quot;十香_1&quot;),
     Criteria.where(&quot;name&quot;).is(&quot;十香_2&quot;));
  template.find(Query.query(criteria), User.class);

  //and or
  Criteria criteria1 = new Criteria()
    .and(&quot;age&quot;).is(23)
    .orOperator(
    Criteria.where(&quot;name&quot;).is(&quot;十香_1&quot;),
    Criteria.where(&quot;name&quot;).is(&quot;十香_2&quot;));
  template.find(Query.query(criteria1), User.class);

  //sort 排序
  Query query = new Query();
  query.with(Sort.by(Sort.Order.desc(&quot;age&quot;)));//desc 降序  asc 升序
  template.find(query, User.class);


  //skip limit 分页
  Query queryPage = new Query();
  queryPage.with(Sort.by(Sort.Order.desc(&quot;age&quot;)))//desc 降序  asc 升序
    .skip(0) //起始条数
    .limit(4); //每页显示记录数
  template.find(queryPage, User.class);


  //count 总条数
  template.count(new Query(), User.class);

  //distinct 去重
  //参数 1:查询条件 参数 2: 去重字段  参数 3: 操作集合  参数 4: 返回类型
  template.findDistinct(new Query(), &quot;name&quot;, 
                        User.class, String.class);

  //使用 json 字符串方式查询 
        Query query = new BasicQuery(
          &quot;{$or:[{name:&#39;十香&#39;},{name:&#39;张小凡&#39;}]}&quot;, 
          &quot;{name:0}&quot;);

  template.find(query, User.class);
}</code></pre>
<h4 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h4><pre><code class="java">@Test
public void testSaveOrUpdate(){
  User user = new User();
  user.setId(&quot;1&quot;);
  user.setAge(23);
  user.setName(&quot;十香_1&quot;);
  user.setBir(new Date());
  User userDB = mongoTemplate.insert(user);//返回保存的对象 insert or save
  System.out.println(userDB);
}</code></pre>
<ul>
<li><strong>insert:</strong> 插入重复数据时：<code>insert</code>报<code>DuplicateKeyException</code>提示主键重复；<code>save</code>对已存在的数据进行更新。</li>
<li><strong>save:</strong> 批处理操作时：<code>insert</code>可以一次性插入整个数据，效率较高；<code>save</code>需遍历整个数据，一次插入或更新，效率较低。</li>
</ul>
<h4 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h4><pre><code class="java">@Test
public void  testUpdate(){
  //1.更新条件
  Query query = Query.query(Criteria.where(&quot;age&quot;).is(23));
  //2.更新内容
  Update update = new Update();
  update.set(&quot;name&quot;,&quot;TenIncense&quot;);

  //单条更新
  mongoTemplate.updateFirst(query, update, User.class);
  //多条更新
  mongoTemplate.updateMulti(query, update, User.class);
  //更新插入（没有符合条件数据插入数据）
  mongoTemplate.upsert(query,update,User.class);

  //返回值均为 updateResult
  //System.out.println(&quot;匹配条数:&quot; + updateResult.getMatchedCount());
  //System.out.println(&quot;修改条数:&quot; + updateResult.getModifiedCount());
  //System.out.println(&quot;插入id_:&quot; + updateResult.getUpsertedId());
}</code></pre>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><pre><code class="java">@Test
public void testDelete(){
  //删除所有
  mongoTemplate.remove(new Query(),User.class);
  //条件删除
  mongoTemplate.remove(
    Query.query(Criteria.where(&quot;name&quot;).is(&quot;十香&quot;)),
    User.class
  );
}</code></pre>
<hr>
<h2 id="十一、副本集"><a href="#十一、副本集" class="headerlink" title="十一、副本集"></a>十一、副本集<replica set></replica></h2><p><a href="https://docs.mongodb.com/manual/replication/" target="_blank" rel="noopener">官方文档</a></p>
<p>MongoDB 副本集（Replica Set）是有自动故障恢复功能的主从集群，有一个Primary节点和一个或多个Secondary节点组成。副本集没有固定的<code>主节点</code>,当<code>主节点</code>发生故障时整个集群会<code>选举一个主节点</code>为系统提供服务以保证系统的高可用。</p>
<img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204081332421.png" style="zoom: 67%;">



<h3 id="Automatic-Failover"><a href="#Automatic-Failover" class="headerlink" title="Automatic Failover"></a>Automatic Failover</h3><p>​    自动故障转移机制: 当主节点未与集合的其他成员通信超过配置的选举超时时间（默认为 10 秒）时，合格的辅助节点将调用选举以将自己提名为新的主节点。集群尝试完成新主节点的选举并恢复正常操作。</p>
<img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204081333566.svg">



<h3 id="搭建副本集"><a href="#搭建副本集" class="headerlink" title="搭建副本集"></a>搭建副本集</h3><ul>
<li><p>创建数据目录</p>
<pre><code class="shell"># 在安装目录中创建(bin)
- mkdir -p ../repl/data1
- mkdir -p ../repl/data2
- mkdir -p ../repl/data3</code></pre>
</li>
<li><p>搭建副本集</p>
<pre><code class="shell">$ mongod --port 27017  --dbpath ../repl/data1 --bind_ip 0.0.0.0 --replSet  myreplace/[121.5.167.13:27018,121.5.167.13:27019]

$ mongod --port 27018  --dbpath ../repl/data2 --bind_ip 0.0.0.0 --replSet  myreplace/[121.5.167.13:27019,121.5.167.13:27017]

$ mongod --port 27019  --dbpath ../repl/data3 --bind_ip 0.0.0.0 --replSet  myreplace/[121.5.167.13:27017,121.5.167.13:27018]</code></pre>
<p><code>注意: --replSet 副本集  myreplace 副本集名称/集群中其他节点的主机和端口</code></p>
</li>
<li><p>配置副本集，连接任意节点</p>
<ul>
<li>use admin</li>
<li>初始化副本集</li>
</ul>
<pre><code class="json">&gt; var config = { 
        _id:&quot;myreplace&quot;,         //副本集名称
        members:[                        //成员
        {_id:0,host:&quot;121.5.167.13:27017&quot;},
        {_id:1,host:&quot;121.5.167.13:27018&quot;},
        {_id:2,host:&quot;121.5.167.13:27019&quot;}]
}
&gt; rs.initiate(config);//初始化配置 </code></pre>
<ul>
<li>设置客户端临时可以访问</li>
</ul>
<pre><code class="sql">&gt; rs.slaveOk();
&gt; rs.secondaryOk();</code></pre>
</li>
</ul>
<hr>
<h2 id="十二、分片集群"><a href="#十二、分片集群" class="headerlink" title="十二、分片集群"></a>十二、分片集群<sharding cluster></sharding></h2><blockquote>
<p>副本集：自动故障转移    主从复制 集群    </p>
<p>解决问题：1.数据冗余备份    2.架构高可用</p>
<p>不能解决：1.单节点压力问题（硬件限制 并发访问压力）    </p>
</blockquote>
<h3 id="说明-4"><a href="#说明-4" class="headerlink" title="说明"></a>说明</h3><p><a href="https://docs.mongodb.com/manual/sharding/" target="_blank" rel="noopener">官方文档</a></p>
<p>​    <code>分片(sharding)</code>是指<code>将数据拆分,将其分散存在不同机器的过程</code>，有时也用<code>分区(partitioning)</code>来表示这个概念,将数据分散在不同的机器上，不需要功能强大的大型计算机就能存储更多的数据，处理更大的负载。</p>
<p>​    分片目的是通过分片能够增加更多机器来应对不断的增加负载和数据，还不影响应用运行。</p>
<p>​    MongoDB支持<code>自动分片</code>,可以摆脱手动分片的管理困扰，集群自动切分数据做负载均衡。MongoDB分片的基本思想就是将集合拆分成多个块，这些快分散在若干个片里，每个片只负责总数据的一部分，应用程序不必知道哪些片对应哪些数据，甚至不需要知道数据拆分了，所以在分片之前会运行一个路由进程，mongos进程，这个路由器知道所有的数据存放位置，应用只需要直接与mongos交互即可。mongos自动将请求转到相应的片上获取数据，从应用角度看分不分片没有什么区别。</p>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><p><img src="https://cdn.jsdelivr.net/gh//Tenincense0714/imgbed@master/img/202204081544701.png" alt></p>
<ul>
<li><p><strong>Shard:</strong>    用于存储实际的数据块，实际生产环境中一个shard server角色可由几台机器组个一个replica set承担，防止主机单点故障</p>
</li>
<li><p><strong>Config Server</strong>:mongod实例，存储了整个 ClusterMetadata。</p>
</li>
<li><p><strong>Query Routers</strong>: 前端路由，客户端由此接入，且让整个集群看上去像单一数据库，前端应用可以透明使用。</p>
</li>
<li><p><strong>Shard Key</strong>: 片键，设置分片时需要在集合中选一个键,用该键的值作为拆分数据的依据,这个片键称之为(shard key)，片键的选取很重要,片键的选取决定了数据散列是否均匀。</p>
</li>
</ul>
<h3 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h3><pre><code class="shell"># 1.集群规划
- Shard Server 1：27017
- Shard Repl   1：27018

- Shard Server 2：27019
- Shard Repl   2：27020

- Shard Server 3：27021
- Shard Repl   3：27022

- Config Server ：27023
- Config Server ：27024
- Config Server ：27025

- Route Process ：27026

# 2.进入安装的 bin 目录创建数据目录
- mkdir -p ../cluster/shard/s0
- mkdir -p ../cluster/shard/s0-repl

- mkdir -p ../cluster/shard/s1
- mkdir -p ../cluster/shard/s1-repl

- mkdir -p ../cluster/shard/s2
- mkdir -p ../cluster/shard/s2-repl

- mkdir -p ../cluster/shard/config1
- mkdir -p ../cluster/shard/config2
- mkdir -p ../cluster/shard/config3

# 3.启动4个 shard服务

# 启动 s0、r0
&gt; ./mongod --port 27017 --dbpath ../cluster/shard/s0 --bind_ip 0.0.0.0 --shardsvr --replSet r0/121.5.167.13:27018
&gt; ./mongod --port 27018 --dbpath ../cluster/shard/s0-repl --bind_ip 0.0.0.0 --shardsvr --replSet r0/121.5.167.13:27017
-- 1.登录任意节点
-- 2. use admin
-- 3. 执行
        config = { _id:&quot;r0&quot;, members:[
      {_id:0,host:&quot;121.5.167.13:27017&quot;},
      {_id:1,host:&quot;121.5.167.13:27018&quot;},
        ]
    }
        rs.initiate(config);//初始化

# 启动 s1、r1
&gt; ./mongod --port 27019 --dbpath ../cluster/shard/s1 --bind_ip 0.0.0.0 --shardsvr  --replSet r1/121.5.167.13:27020
&gt; ./mongod --port 27020 --dbpath ../cluster/shard/s1-repl --bind_ip 0.0.0.0 --shardsvr --replSet r1/121.5.167.13:27019
-- 1.登录任意节点
-- 2. use admin
-- 3. 执行
        config = { _id:&quot;r1&quot;, members:[
      {_id:0,host:&quot;121.5.167.13:27019&quot;},
      {_id:1,host:&quot;121.5.167.13:27020&quot;},
        ]
    }
        rs.initiate(config);//初始化

# 启动 s2、r2
&gt; ./mongod --port 27021 --dbpath ../cluster/shard/s2 --bind_ip 0.0.0.0 --shardsvr --replSet r2/121.5.167.13:27022
&gt; ./mongod --port 27022 --dbpath ../cluster/shard/s2-repl --bind_ip 0.0.0.0 --shardsvr --replSet r2/121.5.167.13:27021
-- 1.登录任意节点
-- 2. use admin
-- 3. 执行
        config = { _id:&quot;r2&quot;, members:[
      {_id:0,host:&quot;121.5.167.13:27021&quot;},
      {_id:1,host:&quot;121.5.167.13:27022&quot;},
        ]
    }
        rs.initiate(config);//初始化

# 4.启动3个config服务

&gt; ./mongod --port 27023 --dbpath ../cluster/shard/config1 --bind_ip 0.0.0.0 --replSet  config/[121.5.167.13:27024,121.5.167.13:27025] --configsvr

&gt; ./mongod --port 27024 --dbpath ../cluster/shard/config2 --bind_ip 0.0.0.0 --replSet  config/[121.5.167.13:27023,121.5.167.13:27025] --configsvr

&gt; ./mongod --port 27025 --dbpath ../cluster/shard/config3 --bind_ip 0.0.0.0 --replSet  config/[121.5.167.13:27023,121.5.167.13:27024] --configsvr

# 5.初始化 config server 副本集
- `登录任意节点 congfig server`
&gt; 1.use admin 
&gt; 2.在admin中执行
  config = { 
      _id:&quot;config&quot;, 
      configsvr: true,
      members:[
          {_id:0,host:&quot;121.5.167.13:27023&quot;},
          {_id:1,host:&quot;121.5.167.13:27024&quot;},
          {_id:2,host:&quot;121.5.167.13:27025&quot;}
        ]
  }
&gt; 3.rs.initiate(config); //初始化副本集配置 

# 6.启动 mongos 路由服务

&gt; ./mongos --port 27026 --configdb config/121.5.167.13:27023,121.5.167.13:27024,121.5.167.13:27025 --bind_ip 0.0.0.0 

# 7.登录 mongos 服务
&gt; 1.登录 mongo --port 27026
&gt; 2.use admin
&gt; 3.添加分片信息
    db.runCommand({ addshard:&quot;r0/121.5.167.13:27017,121.5.167.13:27018&quot;,
    &quot;allowLocal&quot;:true });
    db.runCommand({ addshard:&quot;r1/121.5.167.13:27019,121.5.167.13:27020&quot;,
    &quot;allowLocal&quot;:true });
    db.runCommand({ addshard:&quot;r2/121.5.167.13:27021,121.5.167.13:27022&quot;,
    &quot;allowLocal&quot;:true });
&gt; 4.指定分片的数据库
    db.runCommand({ enablesharding:&quot;baizhi&quot; });

&gt; 5.设置库的片键信息
    db.runCommand({ shardcollection: &quot;baizhi.users&quot;, key: { _id:1}});
    db.runCommand({ shardcollection: &quot;baizhi.emps&quot;, key: { _id: &quot;hashed&quot;}})</code></pre>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="null"></li>
                <li class="wechat-code"><img src="null"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2022/04/08/设计模式/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E6%96%87%E7%AB%A0%E8%83%8C%E6%99%AF/10.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E6%96%87%E7%AB%A0%E8%83%8C%E6%99%AF/10.jpg">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                设计模式</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2022/03/24/JVM/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E6%96%87%E7%AB%A0%E8%83%8C%E6%99%AF/15.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E6%96%87%E7%AB%A0%E8%83%8C%E6%99%AF/15.jpg">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                JVM</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "6RN5znkrKL14y7H74i40TEuh-gzGzoHsz",
        appKey: "a9t6VNN6REJFw4IejG3wBYXS",
        path: window.location.pathname,
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>




      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="tenincense.cn" class="profile gravatar"><img src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/202205291139260.jpg" itemprop="image" alt="TenIncense" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="tenincense.cn" itemprop="url" rel="author">TenIncense</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i>面如霜上雪</p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 TenIncense<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "","name":"","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "","name":"","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://tenincense-1309094827.cos.ap-guangzhou.myqcloud.com/image/%E8%83%8C%E6%99%AF%202/601644262819_.pic.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">TenIncense</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="https://github.com/Tenincense0714" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="https://wpa.qq.com/msgrd?v=3&uin=954655431&site=qq&menu=yes" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/技术/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/生活/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  生活
                </a>
              </li>
            
              <li>
                <a href="/categories/资源/">
                  <i class="fa fa-cloud-download" aria-hidden="true"></i>
                  资源
                </a>
              </li>
            
              <li>
                <a href="/categories/随想/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  随想
                </a>
              </li>
            
              <li>
                <a href="/categories/转载/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  转载
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/悦读/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  书单
                </a>
              </li>
            
              <li>
                <a href="/bangumi/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  番组
                </a>
              </li>
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
              <li>
                <a href="/tags/图集/">
                  <i class="fa fa-photo" aria-hidden="true"></i>
                  图集
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/donate/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
            赞赏
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
              <li>
                <a href="/theme-sakura/">
                  <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                  主题
                </a>
              </li>
            
              <li>
                <a href="/lab/">
                  <i class="fa fa-cogs" aria-hidden="true"></i>
                  Lab
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/client/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-android faa-vertical" aria-hidden="true"></i>
            客户端
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/atom.xml">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
            RSS
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id="2660651585"

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>

<script src="https://cdn.jsdelivr.net/gh/wallleap/cdn/js/canvas-nest.min.js"></script><!--背景动态线条-->
<script src="https://cdn.jsdelivr.net/gh/wallleap/cdn/js/sakura.js"></script><!--樱花特效-->